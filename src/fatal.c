#include "zpc/fatal.h"

#include <stdarg.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
void fatal_z(const char* format, ...)
{
    va_list args;
    va_start(args, format);
    fprintf(stderr, "\033[31mfatal: ");
    vfprintf(stderr, format, args);
    fprintf(stderr, "\033[0m\n");
    va_end(args);
    fflush(stderr);
    abort();
}

// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
void fatal_check_z(const void* ptr, const char* message, ...)
{
    if (!ptr)
    {
        va_list args;
        va_start(args, message);
        fprintf(stderr, "\033[31mfatal: ");
        vfprintf(stderr, message, args);
        fprintf(stderr, "\033[0m\n");
        va_end(args);
        fflush(stderr);
        abort();
    }
}

// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
void fatal_check_bool_z(bool value, const char* message)
{
    if (!value) fatal_z(message);
}

// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
void* fatal_alloc_z(size_t size, const char* message)
{
    void* ptr = malloc(size);
    if (!ptr)
    {
        fatal_z(message);
    }
    memset(ptr, 0, size);
    return ptr;
}
