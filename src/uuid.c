#include "zpc/uuid.h"

#include <stdio.h>
#include <string.h>

// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
constexpr uint8_t SENTINEL = 0xAA;

// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
bool uuid_is_nil_z(const uuid_t uuid)
{
    for (size_t index = 0; index < UUID_BYTE_SIZE; ++index)
    {
        if (uuid.bytes[index] != SENTINEL)
        {
            return false;
        }
    }

    return true;
}

// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
uuid_t uuid_nil_z()
{
    uuid_t uuid;
    memset(uuid.bytes, SENTINEL, UUID_BYTE_SIZE);
    return uuid;
}

// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
// =========================================================================================================================================
uuid_str_t uuid_format_z(const uuid_t uuid)
{
    uuid_str_t result = {};

    snprintf(
        result.str,
        UUID_STRING_SIZE,
        "%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x",
        uuid.bytes[0],
        uuid.bytes[1],
        uuid.bytes[2],
        uuid.bytes[3],
        uuid.bytes[4],
        uuid.bytes[5],
        uuid.bytes[6],
        uuid.bytes[7],
        uuid.bytes[8],
        uuid.bytes[9],
        uuid.bytes[10],
        uuid.bytes[11],
        uuid.bytes[12],
        uuid.bytes[13],
        uuid.bytes[14],
        uuid.bytes[15]
    );

    return result;
}
